<?xml version="1.0"?>
<odoo>
    <data>
        <record id="view_order_form_inherit_aop_sale" model="ir.ui.view">
            <field name="name">sale.order.form.aop.sale</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='order_line']/tree" position="attributes">
                    <attribute name="editable">bottom</attribute>
                </xpath>

                <!-- 添加1个合同价格确认的state -->
                <xpath expr="//field[@name='state']" position="attributes">
                    <attribute name="statusbar_visible">draft,sent,carrier,sale</attribute>
                </xpath>

                <xpath expr="//button[@name='print_quotation']" position="after">
                    <button name="action_quotation_confirm" id="action_quotation_confirm" string="Quotation Confirm"
                            type="object" attrs="{'invisible': [('state', 'not in', ['draft', 'sent'])]}"/>
                </xpath>

                <xpath expr="//button[@name='action_cancel']" position="attributes">
                    <attribute name="states">draft,sent,carrier,sale</attribute>

                </xpath>

                <xpath expr="//button[@name='action_confirm'][1]" position="attributes">
                    <attribute name="attrs">{'invisible': [('state', 'not in', ['carrier'])]}</attribute>

                </xpath>

                <xpath expr="//button[@name='action_confirm'][2]" position="attributes">
                    <attribute name="attrs">{'invisible': 1}</attribute>
                </xpath>

                <!--
                    print和Send By Email按钮也需要调整，这里能看到价格，待原型确定后再补
                -->


                <xpath expr="//button[@name='action_view_delivery']" position="after">
                    <button name="open_vin_picking"
							string="VIN码调拨单"
							type="object"
							class="oe_stat_button"
							icon="fa-list"/>
                </xpath>

                <xpath expr="//field[@name='warehouse_id']" position="replace">

                </xpath>



                <xpath expr="//field[@name='partner_shipping_id']" position="before">

                    <!--
                    <field name="warehouse_id"
                           string="Take Car Address"
                           options="{'no_create': True}"
                           groups="stock.group_stock_multi_locations"
                           attrs="{'invisible': 1}"/>
                    -->

                    <field name="partner_take_care_id"
                           string="Take Car Address"
                           options="{'no_create': True, 'no_open': True}}"
                           domain="[('id','=', partner_id), ('type','=', 'take')]"
                           />

                </xpath>




                <xpath expr="//field[@name='partner_shipping_id']" position="attributes">
                    <attribute name="string">Delivery Car Address</attribute>
                    <attribute name="domain">[('id','=', partner_id), ('type','=', 'delivery')]</attribute>
                    <attribute name="options">{'no_create': True, 'no_open': True}</attribute>

                </xpath>

                <!--# 隐藏付款条款-->
                <xpath expr="//field[@name='payment_term_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <xpath expr="//field[@name='validity_date']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <xpath expr="//field[@name='partner_invoice_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <xpath expr="//field[@name='sale_order_template_id']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <xpath expr="//label[@for='carrier_id']" position="replace">

                </xpath>

                <div name="carrier_selection" position="attributes">
                    <attribute name="invisible">1</attribute>
                </div>

                <xpath expr="//field[@name='order_line']/tree/field[@name='product_id']" position="replace">

                                <field
                                        name="product_id"
                                        domain="[('type','=','product')]"
                                        force_save="1"
                                        context="{
                                            'partner_id': parent.partner_id,
                                            'quantity': product_uom_qty,
                                            'pricelist': parent.pricelist_id,
                                            'uom':product_uom,
                                            'company_id': parent.company_id,
                                            'default_lst_price': price_unit,
                                            'default_description_sale': name
                                        }"
                                        string="货物"
                                    />

                </xpath>

                <!--# 隐藏价格, 以后应该通过group权限来隐藏-->
                <xpath expr="//field[@name='order_line']/tree/field[@name='price_unit']" position="attributes">
                    <!--
                    <attribute name="invisible">[('state', 'in', ['draft'])]</attribute>
                    -->

                    <attribute name="attrs">{'invisible': [('state', 'in', ['draft'])], 'readonly': [('qty_invoiced', '&gt;', 0)]}</attribute>

                </xpath>

                <!--# 隐藏税率-->
                <xpath expr="//field[@name='order_line']/tree/field[@name='tax_id']" position="attributes">
                    <attribute name="attrs">{'invisible': [('state', 'in', ['draft'])], 'readonly': [('qty_invoiced', '&gt;', 0)]}</attribute>
                </xpath>

                <!--# 隐藏小计-->
                <xpath expr="//field[@name='order_line']/tree/field[@name='price_subtotal']" position="attributes">
                    <attribute name="attrs">{'invisible': [('state', 'in', ['draft'])]}</attribute>
                </xpath>

                <!--# 隐藏未税金额-->
                <xpath expr="//field[@name='amount_untaxed']" position="attributes">
                    <attribute name="attrs">{'invisible': [('state', 'in', ['draft'])]}</attribute>
                </xpath>

                <!--# 隐藏税率金额-->
                <xpath expr="//field[@name='amount_tax']" position="attributes">
                    <attribute name="attrs">{'invisible': [('state', 'in', ['draft'])]}</attribute>
                </xpath>

                <!--# 隐藏总计金额-->
                <xpath expr="//field[@name='amount_total']" position="attributes">
                    <attribute name="attrs">{'invisible': [('state', 'in', ['draft'])]}</attribute>
                </xpath>

                <xpath expr="//field[@name='order_line']/tree/field[@name='product_id']" position="after">
                    <field name="service_product_id" domain="[('type','=','service')]" attrs="{'required': 1}" />
                    <field name="carrier_id"  domain="[('partner_id','=', parent.partner_id)]" />
                    <field name="carrier_price" />
                    <field name="vin"/>
                </xpath>

                <!--<xpath expr="//field[@name='order_line']/tree/field[@name='route_id']" position="after">-->
                    <!--<field name="route_id"  domain="[('partner_id','=', parent.partner_id)]" />-->
                <!--</xpath>-->


                <xpath expr="//field[@name='order_line']/form/group/group/div/field[@name='product_uom_qty']" position="attributes">
                    <attribute name="readonly">1</attribute>
                </xpath>

                <xpath expr="//field[@name='order_line']/form/group/group/field[@name='product_id']"
                       position="replace">

                    <label string="货物" for="product_id"/>
                    <field name="product_id"
                                                context="{'partner_id':parent.partner_id, 'quantity':product_uom_qty, 'pricelist':parent.pricelist_id, 'uom':product_uom, 'company_id': parent.company_id}"
                                                nolabel="1"
                                                force_save="1"
                                                domain="[('type','=','product')]"
                                               />

                </xpath>


                <xpath expr="//field[@name='order_line']/form/group/group/field[@name='product_id']" position="after">

                    <!--<field name="service_product_id" domain="[('type','=','service')]" attrs="{'required': 1}" />-->

                    <label for="carrier_id"/>
                    <div name='carrier_selection'>
                        <div>
                            <field name="carrier_id" domain="[('partner_id','=', parent.partner_id)]" class="oe_inline"
                                   options="{'no_create': True, 'no_open': True}"
                                   attrs="{'readonly':[('state','not in',('draft','sent'))]}"/>

                        </div>

                    </div>
                    <!--<field name="carrier_price" />-->
                    <field name="vin"/>
                </xpath>

                <xpath expr="//group[@name='sale_total']" position="attributes">
                    <attribute name="invisible">0</attribute>
                </xpath>

            </field>
        </record>


    </data>
</odoo>